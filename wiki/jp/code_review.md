このWikiでは、コードレビューの実施方法について記載する

## 目的・概要

* ソースコードのバグの有無をダブルチェックする
* リーダビリティを上げる
* エンジニアの技術水準を統一する
* コーディングルールの統一を図る

#### 若手（新入社員）でもコードレビュアーとなることが良い理由

* 若手のほうが丁寧にレビューを行うので、簡易的な指摘可能事項に関してのレビューの質が高い
* 若手の勉強になるし、学習スピードがとても速い
* 先輩エンジニアの技術意識も高まる（若手なんぞに指摘されたくはないという恥ずかしさもあるので）
* 「レビューしてよい人」と「レビューしてはだめなひと」という意味のない差別がなくなり精神的に安定する

#### レビュー単位

* 機能ごとに（つまり、何か実際に動く単位で）リクエストを送る


>細かくRequestを送ることが難しい場合は、早めにPull Requestを作成し、随時見てもらうという方法があります。[WIP](Work in Progressの略)をタイトルの頭につけて、完成前のある程度中身が見えてきた段階でPull Requestを送るとよいです。（Wantedlyエンジニア　Aikawaさん）

## フロー

1. 開発者の実装
2. 

例として `avatar`というブランチネームで作成された機能をレビューする場合

```
# レビュー用の一時worktreeの作成
git worktree add ../avatar -b avatar
cd ../avatar

# ソースコードのpull
(自分がavatarブランチにいることを確認する)
git pull origin avatar

# editorでdatabase.ymlファイルの設定を依頼者と合わせる（必要に応じて）
development:
  adapter: mysql2
  encoding: utf8mb4
  database: ab_local     # <- こことか
  pool: 5
  username: alarmbox
  password: alarmbox
  socket: /var/lib/mysql/mysql.sock
  # host: 192.168.33.11
  host: 192.168.11.237     # <- こことか


```

## レビュアーが気を付けること

**Logic check**

* 境界条件でうまく動くか確認
    * 特に要素がない時 (0, nil, empty array etc.) もエラーが出なく、表示的にも問題ないか
* テストがちゃんと問題が起こっているとき、きちんとFailするテストになっているか
* `rescue`している部分は、本当にそこでレスキューしてよいのか
* 想定されるエラーに対して、メールを飛ばすべきか、無視して続けるべきか、止めるべきか
    * そのエラーはどのような原因によって生じるのか、そしてそれが生じたときユーザー目線ではどのようにあってほしいのか考える
* トランザクションが必要な箇所がないか
    * あれば、その点でトランザクションが機能しているか確認
* 結果を返し忘れたりしてしまうコードパスがないか
* バグを生みやすいコードがないか
    * 例えば、rubyでif文以外ではsaveでなくsave!を使っておく等

**Readability check**

* 不要なif文のチェック
    * 関数の最初でif文を用いて特定の条件だけで動かすコードは、 `return if`を先頭に置く
    * 5行使っているif文は1行にできないか（ternary operatorの活用）
* ハードコーディングされている定数がないか
    * クラス先頭で大文字で定義する
    * グローバル定数で定義する
* わかりやすい名がついているか
    * `list`, `data`などの、何を指しているのか不透明なネーミングをしていないか
    * 関数のネーミングは機能に即しているか
    * 関数のネーミングが、RESTful設計思想に適ったものになっているか（機能的に `index`であるところを `index`以外の名前になっていないか）
* スタイルシートで修正を加えた箇所が、他に影響していないか
    * そのCSS selectorを他に使っている箇所がないか（共通して使っているような `card`などのCSSを変更する際は特に注意）

**特に気を付ける点**

* モデルの修正は大変なのでビューに比べて念入りに見る
* メールの送信など送ってしまったら取り返しがつかないものはきちんと試してみる
* セキュリティの問題を抱えやすい場所は注意する
* ユーザー入力を埋め込んでる場所など (XSS/SQL Injection etc)
* サービスの根本的な価値や、お金につながるような変更は死ぬ気で見る


## レビューを依頼する人が気を付けること

* リクエスト依頼時に、機能の目的や概要をレビュアーに説明する
* そもそも、なるべく機能ごとに分けて開発する
* ブランチ名は機能がわかる名前にする
* 「自分でもよくわからないけど書いた」という部分をなくす
* 開発時に安易に他のコードをコピー＆ペーストしない。コピペするときには以下のような点に注意する：
    * フロントエンドなら、不必要なCSS selectorがついたままになっていないか
    * バックエンドなら、使わない変数を残していないか、変数の取りうる値はコピー元の機能と同じか
* どのような考えをもって、どのような点を検討してそのコードに至ったのか記しておく
    * サーバーサイドのファイルであれば、そのファイル中にコメントで付す
    * HTMLなどフロント側であれば、中間言語のコメントとして記すか、別ファイルに集約しておく（ただし、コメントがあることはHTMLファイルに `ref.1`などで記しておく）
    * Githubを用いて開発している場合は、イシューを切ってそこに議論を記す
    * Project管理ツールを用いている場合は、当該ツール上で議論を記すことも可能。ただし、当時関与していないエンジニアが将来そのログをたどることができるよう（議論の存在に気付ける工夫）にしておく
* 必要に応じてシードを作成するか、シード作成に必要なコードをpullリクエスト時に共有する
    * 新たなDBテーブル・カラムを作成した場合などは、レビュアーが動かすときに必要なDBクエリやシード生成コードを共有する
    * あるいは、自分のDBを開放（VagrantでIPをpublicとして立ち上げる）して、IPを共有して使ってもらう